<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>applauncherd: Enabling a splash screen for an application</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.7.1 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul class="tablist">
      <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div class="navpath">
    <ul>
      <li><a class="el" href="main.html">Optimising application startup</a>      </li>
    </ul>
  </div>
</div>
<div class="header">
  <div class="headertitle">
<h1>Enabling a splash screen for an application </h1>  </div>
</div>
<div class="contents">
<h2><a class="anchor" id="splashsec"></a>
Enabling a splash screen</h2>
<p>Applauncherd allows an application to show a splash screen if the mcompositor (the MeeGo 1.2 Harmattan window manager) is running.</p>
<p>The splash screen is not shown by default. If an application wants it to be shown, it must pass --splash, and optionally --splash-landscape arguments to the invoker. System default splash images can be obtained by giving <code>default</code> or <code>default-landscape</code> in place of image file names.</p>
<p>For instance, the following shows the splash screen with splash.jpg as its content when the device is in the portrait orientation:</p>
<div class="fragment"><pre class="fragment">
/usr/bin/invoker --splash=/usr/share/application_name/splash.jpg --splash-landscape=/usr/share/application_name/splash-l.jpg --type=d /usr/bin/application_name
</pre></div><p>Otherwise splash-l.jpg is shown. If only --splash is given, that image is shown in both orientations.</p>
<p>The dimensions of both portrait and landscape images should be the same &lt;screen width&gt; X &lt;screen height&gt;; it means that mcompositor does not rotate the splash image, it should be drawn rotated.</p>
<p>Invoker passes the splash request to the booster. The booster sends the splash request to the window manager by setting a window property to window manager's window.</p>
<p>If the filenames do not include absolute paths, the window manager looks for the files from a default location.</p>
<p>The file should be in a format recognised by QPixmap, preferably JPEG as it is fast to load. Splash screen is always scaled to fit the full screen, hiding the status bar. Thus, the recommended size for the screen is 854 x 480 pixels. However, the figure is displayed even if the size is different.</p>
<p>Create a splash screen that resembles as much as possible the window that is shown when your application is launched. For instance, the splash screen can have the same background colour and toolbar as the application window. If the application window displays the status area, we recommend adding a black box with the same size to the splash screen of your application.</p>
<h3><a class="anchor" id="splashndbus"></a>
Splash and D-Bus interaction</h3>
<p>If you want to invoke the application through D-Bus as well as from the application grid, follow the instructions in this section. This also applies to single instance behaviour provided by <code>MApplication</code>, so you may be using D-Bus even if there is no D-Bus related code in your application.</p>
<p>If splash is not used, the <code>Exec</code> line in the application's <code></code>.desktop file may contain the invoker command line for starting the application. One of the first things that D-Bus enabled applications do is to register a service with the session D-Bus, which fails if another instance of the application is already running. In this case, an <code>MApplication</code> based application by default first calls the <code>launch()</code> D-Bus method of the existing application instance and then exits. The end result is that the existing instance is brought to the foreground and there is just one instance of the application running.</p>
<p>This changes when the <code>--splash</code> option is used in an invoker command in the <code>Exec</code> line of the <code></code>.desktop file. When the application is started from the grid and there is already an instance of the application running, the following sequence of events takes place:</p>
<ul>
<li>The path to the splash image and the pid of the new application instance are passed to the compositor. </li>
<li>The application's <code>main()</code> is called and the application starts to execute </li>
<li>The compositor shows the splash image and starts to wait for the application with the specified pid to map a window. </li>
<li>The freshly started application attempts to register the D-Bus service, fails, calls the <code>launch()</code> D-Bus method of the existing instance, and exits. </li>
<li>The window of the already running application instance is mapped. </li>
<li>The compositor ignores this window, because it has a different pid from the one specified in the splash request. </li>
<li>The compositor finally gives up waiting for the specified pid to map a window, and fades out the splash screen, revealing the application window.</li>
</ul>
<h3><a class="anchor" id="splashndbusdeploy"></a>
Deployment with splash and D-Bus on Harmattan</h3>
<p>There are two ways to solve the D-Bus related problem described in the previous section. Firstly, you can use the single instance support of the invoker, and, secondly, you can use a D-Bus service in the <code></code>.desktop file. The following examples demonstrate how to do this with the <code>helloworld</code> application.</p>
<p>In the first approach, there is an <code>Exec</code> line with <code>invoker</code> command in both the <code></code>.desktop file and the <code></code>.service file. Both lines use both the <code>--single-instance</code> flag and the <code>--splash</code> flag:</p>
<div class="fragment"><pre class="fragment">[Desktop Entry]
Type=Application
Name=Helloworld
Icon=icon-l-helloworld
Exec=/usr/bin/invoker --single-instance --splash /usr/share/helloworld/helloworld-splash.jpg --type=d /usr/bin/helloworld
</pre></div><div class="fragment"><pre class="fragment">[D-BUS Service]
Name=com.nokia.helloworld
Exec=/usr/bin/invoker --single-instance --splash /usr/share/helloworld/helloworld-splash.jpg --type=d /usr/bin/helloworld
</pre></div><p>In the second approach, the <code></code>.desktop file specifies the D-Bus service, and the invoker command is in the <code>Exec</code> line of the <code></code>.service file. In this case there is no need for the <code>--single-instance</code> flag. A minor problem is that the <code>Exec</code> line is required even if it is not used.</p>
<div class="fragment"><pre class="fragment">[Desktop Entry]
Type=Application
Name=Helloworld
Icon=icon-l-helloworld
Exec=/path/not/used
X-Maemo-Service=com.nokia.helloworld
</pre></div><div class="fragment"><pre class="fragment">[D-BUS Service]
Name=com.nokia.helloworld
Exec=/usr/bin/invoker --splash /usr/share/helloworld/helloworld-splash.jpg --type=d /usr/bin/helloworld
</pre></div> </div>
<hr class="footer"/><address class="footer"><small>Generated on Sun Mar 31 2013 20:49:12 for applauncherd by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.1 </small></address>
</body>
</html>
