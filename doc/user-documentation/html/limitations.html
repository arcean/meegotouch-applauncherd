<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>applauncherd: Limitations and known issues</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.7.1 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul class="tablist">
      <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div class="navpath">
    <ul>
      <li><a class="el" href="main.html">Optimising application startup</a>      </li>
      <li><a class="el" href="tipsandtricks.html">Tips and tricks</a>      </li>
    </ul>
  </div>
</div>
<div class="header">
  <div class="headertitle">
<h1>Limitations and known issues </h1>  </div>
</div>
<div class="contents">
<h2><a class="anchor" id="issue-exit"></a>
Using _exit() instead of exit()</h2>
<p>Use <code>_exit()</code> instead of <code>exit()</code> with QML, Qt, and MeeGo Touch boosters. However, do not use it with exec booster.</p>
<p>The basic difference between <code>exit()</code> and <code>_exit()</code> is that the former performs cleanup related to user-mode constructs in the library and calls user-supplied cleanup-functions, whereas the latter performs only the kernel cleanup for the process.</p>
<p>The function <code>_exit()</code> terminates the calling process immediately. Any open file descriptors belonging to the process are closed; any children of the process are inherited by process.</p>
<p>The <code>exit()</code> function causes normal process termination and the value of status is returned to the parent. A child process must strictly use <code>_exit()</code> instead of a simple <code>exit()</code>.</p>
<p>The user-level initialisations of the libraries are done once when the launcher daemon loads the libraries. The launched applications are child processes of the launcher, and every time <code>exit()</code> is called, the corresponding cleanup actions are executed. The root problem is that the cleanup actions are carried out multiple times, and libraries may not be designed to tolerate this. By calling <code>_exit()</code> in the applications, the problem is avoided.</p>
<h2><a class="anchor" id="issue-cmdline"></a>
Command line arguments</h2>
<p>Current launcher implementation does not support the following Qt and MeeGo Touch command line options. For more information on QApplication command line options, see MeeGo 1.2 Harmattan API reference library. For more information on MApplication command line options, see Platform API reference library.</p>
<ul>
<li><code>-style</code> </li>
<li><code>-stylesheet</code> </li>
<li><code>-session</code> </li>
<li><code>-widgetcount</code> </li>
<li><code>-reverse</code> </li>
<li><code>-graphicssystem</code> </li>
<li><code>-display</code> </li>
<li><code>-geometry</code> </li>
<li><code>-fn</code> </li>
<li><code>-font</code> </li>
<li><code>-bg</code> </li>
<li><code>-background</code> </li>
<li><code>-fg</code> </li>
<li><code>-foreground</code> </li>
<li><code>-btn</code> </li>
<li><code>-button</code> </li>
<li><code>-name</code> </li>
<li><code>-title</code> </li>
<li><code>-visual</code> </li>
<li><code>-ncols</code> </li>
<li><code>-cmap</code> </li>
<li><code>-im</code> </li>
<li><code>-inputstyle</code> </li>
<li><code>-genimglist</code> </li>
<li><code>-remote-theme</code> </li>
<li><code>-fullscreen</code> </li>
<li><code>-disable-m-input-context</code> </li>
</ul>
<p>QCoreApplication::arguments() returns a QStringList that containing at most 32 arguments and drops the rest. The full list of arguments is accessible through <code>argc</code> and <code>argv</code>. They can be converted into QStringList similar to returned by QCoreApplication::arguments() as follows:</p>
<div class="fragment"><pre class="fragment">M_EXPORT <span class="keywordtype">int</span> main(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> **argv) {
    QStringList arguments;
    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> a = 0; a &lt; argc; ++a) {
        arguments &lt;&lt; QString::fromLocal8Bit(argv[a]);
    }
    ...
</pre></div><h2><a class="anchor" id="issue-watchdog"></a>
Scripts, D-Bus, and process monitoring</h2>
<p>By default, invoker processes terminate before or right after booster processes have called main(). This can confuse shell scripts and process monitoring in D-Bus daemon and Upstart, for instance. To solve these issues, you can use the following parameters supported by the invoker:</p>
<ul>
<li><code> --delay 10 </code> The invoker waits for 10 seconds before terminating </li>
<li><code>--wait-term </code> The invoker does not terminate until the launched application terminates. The invoker returns the same return value as the application did, or it is terminated by the same signal as the launched application. Signals received by the invoker process are forwarded to the launched application.</li>
</ul>
<h2><a class="anchor" id="forking"></a>
Forking</h2>
<p>It is not possible to use MComponentCache or <a class="el" href="classMDeclarativeCache.html" title="Cache class for QDeclarativeBooster.">MDeclarativeCache</a> in the child process if you fork() in your application. This is due to the fact that X11 connections are disrupted after fork().</p>
<h2><a class="anchor" id="crashes"></a>
Crashes after application's main()</h2>
<p>If an application is launched with invoker, there may be some destructors of MeeGo Touch classes executed after application's main(). This can cause crashes if the application has installed a custom debug message handler and does not uninstall it before exit.</p>
<h2><a class="anchor" id="splashlimitations"></a>
Splash screen</h2>
<p>Splash screen functionality needs support from the <code>mcompositor</code> window manager.</p>
<h2><a class="anchor" id="wm_class_value"></a>
WM_CLASS value</h2>
<p>If an application is started with m-booster but it creates its own MApplicationWindow based object, such as an MApplicationWindow derived class object, or if an application has multiple windows, the launcher does not currently set the correct value for WM_CLASS property of X window. The WM_CLASS property is used, for example, by Compositor as the application name to notify the user if the application is stuck.</p>
<p>Set the WM_CLASS property for the application as follows:</p>
<div class="fragment"><pre class="fragment">M_EXPORT <span class="keywordtype">int</span> main(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> **argv)
{
    MApplication *app = MComponentCache::mApplication(argc, argv);
    
    <span class="comment">//don&#39;t use window from cache, create our own</span>
    MApplicationWindow *window = <span class="keyword">new</span> myDerivedMApplicationWindow();

<span class="preprocessor">#ifdef Q_WS_X11</span>
<span class="preprocessor"></span>            <span class="comment">// reinit WM_COMMAND X11 property</span>
            <span class="keywordflow">if</span> (window) {
                Display *display = QX11Info::display();
                <span class="keywordflow">if</span> (display) {
                    XSetCommand(display, window-&gt;effectiveWinId(), argv, argc);

                    <span class="comment">// set correct WM_CLASS properties</span>
                    QString appName = QFileInfo(argv[0]).fileName();
                    QString appClass = appName.left(1).toUpper();
                    <span class="keywordflow">if</span> (appName.length() &gt; 1)
                        appClass += appName.right(appName.length() - 1);
           
                    <span class="comment">// reserve memory for C strings</span>
                    QByteArray arrName(appName.toLatin1());
                    QByteArray arrClass(appClass.toLatin1());

                    XClassHint class_hint;
                    class_hint.res_name  = arrName.data();
                    class_hint.res_class = arrClass.data();

                    XSetClassHint(display, window-&gt;effectiveWinId(), &amp;class_hint);
                }
            }
<span class="preprocessor">#endif</span>
<span class="preprocessor"></span>
    <span class="comment">// do application specific stuff</span>
    ...    

    window-&gt;show();
    <span class="keywordflow">return</span> app-&gt;exec();
}
</pre></div> </div>
<hr class="footer"/><address class="footer"><small>Generated on Sun Mar 31 2013 20:49:11 for applauncherd by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.1 </small></address>
</body>
</html>
