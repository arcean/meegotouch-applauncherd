<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>applauncherd: Optimising application startup</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.7.1 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul class="tablist">
      <li class="current"><a href="main.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
</div>
<div class="header">
  <div class="headertitle">
<h1>Optimising application startup </h1>  </div>
</div>
<div class="contents">
<h2><a class="anchor" id="introduction"></a>
Introduction</h2>
<p>The <code>invoker</code> program and the <code>applauncherd</code> daemon help applications launch faster and save memory through shared resources and application type specific initialisations. The <code>invoker</code> uses a socket connection to request application launch, and applications are forked from the daemon process so that they can share memory with the daemon (and each other) using copy-on-write. The invoker also provides application specific splash screen support, and provides a single instance facility that allows only one instance of an application to be running at a time.</p>
<p>The following table shows what services are available for different kinds of applications.</p>
<table class="doxtable">
<tr>
<th></th><th>boosting </th><th>splash </th><th>single instance </th></tr>
<tr>
<td>QML </td><td>x </td><td>x </td><td>x </td></tr>
<tr>
<td>Qt </td><td>x(1) </td><td>x </td><td>x </td></tr>
<tr>
<td>MeeGo Touch</td><td>x </td><td>x </td><td>x </td></tr>
<tr>
<td>other </td><td>- </td><td>x </td><td>x </td></tr>
</table>
<p>(1) Only library preloading.</p>
<p>All functionality of the launcher daemon is accessed using the <code>invoker</code> program. The daemon is usually started automatically as part of the UI session (for example, <code>upstart</code> in MeeGo 1.2 Harmattan).</p>
<p>The <code>applauncherd</code> daemon process links in a set of libraries so that the launched applications do not need to do linking and symbol resolution for the libraries at startup. In addition, startup latency is reduced by doing some initialisations before application launch.</p>
<p>When <code>applauncherd</code> is started, it forks off a number of <em>booster</em> processes, one for each application type supported by the launcher. The boosters first do some application type specific but application independent initialisation if applicable. For example, the QML booster instantiates a <code>QApplication</code> and a <code>QDeclarativeView</code>, and stores the instances in <a class="el" href="classMDeclarativeCache.html" title="Cache class for QDeclarativeBooster.">MDeclarativeCache</a>. Each booster then starts listening on its dedicated socket.</p>
<p>Applications are launched by using the <code>invoker</code> program. The invoker sends the path of the application binary to the desired booster process, along with data on its running environment (for example, command line arguments and environment variables). The booster process loads the binary, initialises its environment, and finally calls the <code>main()</code> function in the binary. If the booster process had instantiated some objects, they can be picked up from the cache instead of constructing them at startup. For example, a QML application runner written in C++ can pick up the <code>QApplication</code> and <code>QDeclarativeView</code> instances from <a class="el" href="classMDeclarativeCache.html" title="Cache class for QDeclarativeBooster.">MDeclarativeCache</a>.</p>
<h2><a class="anchor" id="gettingstarted"></a>
Getting started</h2>
<p>This section gives a quick introduction on <code>invoker</code> usage and boosting applications.</p>
<p>Note: The QML booster and single instance support are currently included in the Qt Quick application template provided by the Qt SDK. To enable these features in your application, select Make application boostable checkbox when creating a new project with the template.</p>
<h3><a class="anchor" id="boostingqtquick"></a>
Boosting Qt Quick applications</h3>
<p>In order to boost Qt Quick applications with <code>invoker</code>, some changes in the application and the way it is built are needed. The process is similar for MeeGo Touch applications and plain Qt applications, for details see appropriate documentation below. The <code>applauncherd-dev</code> package needs to be installed to get the necessary headers and libraries.</p>
<p>In the following example a QML application uses a simple C++ based runner. The first step is to modify the application so that it picks up instances of <code>QApplication</code> and <code>QDeclarativeView</code> from <a class="el" href="classMDeclarativeCache.html" title="Cache class for QDeclarativeBooster.">MDeclarativeCache</a>. To do this, the include directive for <a class="el" href="classMDeclarativeCache.html" title="Cache class for QDeclarativeBooster.">MDeclarativeCache</a> is needed, and the lines where the classes are instantiated need to be modified:</p>
<div class="fragment"><pre class="fragment"><span class="preprocessor">    #include &lt;MDeclarativeCache&gt;</span>
</pre></div><div class="fragment"><pre class="fragment">     QApplication *app = <a class="code" href="classMDeclarativeCache.html#ab46601ff7a2f071a98e02d95ece551c5" title="Returns QApplication instance from cache or creates a new one.">MDeclarativeCache::qApplication</a>(argc, argv);
     QDeclarativeView *window = <a class="code" href="classMDeclarativeCache.html#a937199a0f4c808ea520f785e16c456ce" title="Returns QDeclarativeView instance from cache or creates a new one.">MDeclarativeCache::qDeclarativeView</a>();
</pre></div><p>All the boosters except the exec booster need the application binary to be compiled as Position Independent Executable (PIE). This is achieved by using <code>-fPIC</code> when compiling and <code>-rdynamic</code> <code>-pie</code> when linking. A minimal QML helloworld could be compiled as linked as follows.</p>
<div class="fragment"><pre class="fragment">c++ -DQT_GUI_LIB -DQT_CORE_LIB -I/usr/include/qt4 -I/usr/include/qt4/QtGui -I/usr/include/qt4/QtCore -fPIC -I/usr/include/applauncherd -o main.o -c main.cpp
c++ main.o  -o qml-helloworld -rdynamic -pie -lmdeclarativecache -lQtCore -lQtDeclarative 
</pre></div><p>The resulting binary can now be launched using the invoker as follows. The <code>--type=d</code> command parameter specifies that this is a QML application.</p>
<div class="fragment"><pre class="fragment">invoker --type=d ./qml-helloworld
</pre></div><p>Normally the compiler and linker flags are provided automatically either by using <a class="el" href="usingpkgconfig.html">pkg-config</a> directly, or using it via <a class="el" href="usingcmake.html">CMake</a> or <a class="el" href="usingqmake.html">qmake</a>.</p>
<p>It is also a good idea to hide any unnecessary symbols in the application binary to speed up opening it in the booster. For instructions, see <a class="el" href="qmlboost.html">Using the QML booster</a> and <a class="el" href="libmeegotouchboost.html">Using the MeeGo Touch booster</a>.</p>
<h3><a class="anchor" id="gettingstartedebooster"></a>
Splash screen and single instance</h3>
<p>The <code>invoker</code> can be used to get a splash screen for the application and to implement single instance behaviour. If the <em>exec</em> <em>booster</em> is used, no modifications to the application source code are needed. For more details, see <a class="el" href="eboost.html">Using the exec booster</a> and <a class="el" href="splash.html">Enabling a splash screen for an application</a>. Note that the <em>exec</em> booster facilitates the use of the splash screen and single instance. If you need to reduce application startup time significantly, use other boosters instead.</p>
<p>Simply specify the name of the splash image on the invoker command line as follows.</p>
<div class="fragment"><pre class="fragment">invoker --type=e --splash=/usr/share/images/myAppSplash.jpg /usr/bin/myApp
</pre></div><p>To request single instance behaviour, use the following command line option:</p>
<div class="fragment"><pre class="fragment">invoker --type=e --single-instance /usr/bin/myApp
</pre></div><p>This causes <code>invoker</code> to look for a running instance of the application using a simple lock file based mechanism. If an already running instance is found, it is brought to the foreground instead of launching a new instance of the application. See <a class="el" href="singleinstance.html">Enabling single instance support for an application</a> for more information.</p>
<p>The options can also be combined, in which case the splash screen is only shown when a new instance of the application is started:</p>
<div class="fragment"><pre class="fragment">invoker --type=e --single-instance --splash=/usr/share/images/myAppSplash.jpg /usr/bin/myApp
</pre></div><h2><a class="anchor" id="reference"></a>
Further information</h2>
<ul>
<li>How to enable boosted startup for different types of applications:<ul>
<li><a class="el" href="qmlboost.html">Using the QML booster</a></li>
<li><a class="el" href="qtboost.html">Using the Qt booster</a></li>
<li><a class="el" href="libmeegotouchboost.html">Using the MeeGo Touch booster</a></li>
<li><a class="el" href="eboost.html">Using the exec booster</a></li>
</ul>
</li>
</ul>
<ul>
<li><a class="el" href="splash.html">Enabling a splash screen for an application</a></li>
</ul>
<ul>
<li><a class="el" href="singleinstance.html">Enabling single instance support for an application</a></li>
</ul>
<h2><a class="anchor" id="tipsntricks"></a>
Tips and tricks</h2>
<p>See <a class="el" href="tipsandtricks.html">Tips and tricks</a>. </p>
</div>
<hr class="footer"/><address class="footer"><small>Generated on Sun Mar 31 2013 20:49:10 for applauncherd by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.1 </small></address>
</body>
</html>
